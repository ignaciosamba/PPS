C51 COMPILER V9.53.0.0   CONFIGURADOR                                                      05/08/2015 16:01:37 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE CONFIGURADOR
OBJECT MODULE PLACED IN configurador.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.exe configurador.c DB OE BR INCDIR(C:\SiLabs\MCU\Inc)

line level    source

   1          /** Este archivo actua con la memoria flash y guarda las opciones configuracion
   2           * cada vez que hubo una configuracionnueva. Tambien saca las configuraciones de la
   3           * memoria y las carga en el programa en cada inicio del dispositivo.
   4           *  Tambien configura los registros de las interrupciones
   5          **/
   6          
   7          #include "headers.h"
   8          #include "configurador.h"
   9          #include "control.h"
  10          
  11          
  12          
  13          void iniciar_puertos (void)
  14          {
  15   1         P0MDOUT |= 0x10;                    // Enable UTX as push-pull output
  16   1         XBR0     = 0x01;                    // Enable UART on P0.4(TX) and P0.5(RX)                     
  17   1         XBR1     = 0x40;                    // Enable crossbar and weak pull-ups
  18   1      }
  19          
  20          void iniciar_sysclock (void)
  21          {
  22   1         OSCICN |= 0x03;                     // configuracion del oscilador para la maxima frecuencia
  23   1         RSTSRC  = 0x04;                     // Enable missing clock detector
  24   1      }
  25          
  26          
  27          void seleccionar_puerto(short int puerto)
  28          {
  29   1              switch (puerto)
  30   1              {
  31   2                      case 1:
  32   2                              puerto = 0x08;
  33   2                              break;
  34   2                      case 2:
  35   2                              puerto = 0x18;
  36   2                              printf("elegi el puerto 2\n");
  37   2                              break;
  38   2                      case 3:
  39   2                              puerto = 0x28;
  40   2                              break;
  41   2                      case 4: 
  42   2                              puerto = 0x38;
  43   2                              break;
  44   2                      case 5:
  45   2                              puerto = 0x48;
  46   2                              break;
  47   2                      case 6:
  48   2                              puerto = 0x58;
  49   2                              break;
  50   2                      case 7:
  51   2                              puerto = 0x68;
  52   2                              break;
  53   2                      case 8:
  54   2                              puerto = 0x78;
  55   2                              break;
C51 COMPILER V9.53.0.0   CONFIGURADOR                                                      05/08/2015 16:01:37 PAGE 2   

  56   2                      default:
  57   2                              printf("ESTAMOS EN LA B \n" );
  58   2                              break;
  59   2              }
  60   1              ADC0MUX = puerto;
  61   1      }
  62          
  63          
  64          int iniciar_ADC()
  65          {
  66   1      
  67   1              REF0CN |= 0x03;                     // Enable internal Vref
  68   1              ADC0CN = 0x00;                      // Gain = 1, Unipolar mode
  69   1              ADC0CF = 0x00;                      // Interrupts upon SINC3 filter output
  70   1                                                 // and uses internal VREF
  71   1      
  72   1              ADC0CLK = (SYSCLK/MDCLK)-1;         // Generate MDCLK for modulator.
  73   1                                                 // Ideally MDCLK = 2.4576MHz
  74   1      
  75   1              // Program decimation rate for desired OWR
  76   1              ADC0DEC = ((unsigned long) MDCLK / (unsigned long) OWR /
  77   1                        (unsigned long) 128) - 1;
  78   1      
  79   1              ADC0BUF = 0x00;                     // Turn off Input Buffers
  80   1      
  81   1              ADC0MUX = 0x08;                     // Select AIN0.0
  82   1      
  83   1              ADC0MD = 0x81;                      // Start internal calibration
  84   1              while(AD0CALC != 1);                // Wait until calibration is complete
  85   1      
  86   1              EIE1   |= 0x08;                     // Enable ADC0 Interrupts
  87   1              ADC0MD  = 0x80;                     // Enable the ADC0 (IDLE Mode)
  88   1              
  89   1              return 0;
  90   1      }
  91          
  92          
  93          int iniciar_UART(void)
  94          {
  95   1      
  96   1              SCON0 = 0x10;                       // SCON0: 8-bit variable bit rate
  97   1                                                 //        level of STOP bit is ignored
  98   1                                                 //        RX enabled
  99   1                                                 //        ninth bits are zeros
 100   1                                                 //        clear RI0 and TI0 bits
 101   1              if (SYSCLK/BAUDRATE/2/256 < 1) 
 102   1              {
 103   2                      TH1 = -(SYSCLK/BAUDRATE/2);
 104   2                      CKCON &= ~0x0B;                  // T1M = 1; SCA1:0 = xx
 105   2                      CKCON |=  0x08;
 106   2              } 
 107   1              else if (SYSCLK/BAUDRATE/2/256 < 4) 
 108   1              {
 109   2                      TH1 = -(SYSCLK/BAUDRATE/2/4);
 110   2                      CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 01                  
 111   2                      CKCON |=  0x01;
 112   2              } 
 113   1              else if (SYSCLK/BAUDRATE/2/256 < 12) 
 114   1              {
 115   2                      TH1 = -(SYSCLK/BAUDRATE/2/12);
 116   2                      CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 00
 117   2              } 
C51 COMPILER V9.53.0.0   CONFIGURADOR                                                      05/08/2015 16:01:37 PAGE 3   

 118   1              else 
 119   1              {
 120   2                      TH1 = -(SYSCLK/BAUDRATE/2/48);
 121   2                      CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 10
 122   2                      CKCON |=  0x02;
 123   2              }
 124   1      
 125   1              TL1 = TH1;                          // Init Timer1
 126   1              TMOD &= ~0xf0;                      // TMOD: timer 1 in 8-bit autoreload
 127   1              TMOD |=  0x20;                       
 128   1              TR1 = 1;                            // START Timer1
 129   1              TI0 = 1;                            // Indicate TX0 ready
 130   1      
 131   1              return 0;
 132   1      }
 133          
 134          int iniciar_interrupciones(void)
 135          {
 136   1              
 137   1              return 0;
 138   1      }
 139          
 140          int iniciar_FLASH(void)
 141          {
 142   1              
 143   1              return 0;
 144   1      }
 145          
 146          int cargar_configuracionFlash(void)
 147          {
 148   1              return 0;
 149   1      }
 150          
 151          int guardar_configuracionFlash(void)
 152          {
 153   1              return 0;
 154   1      }
 155          
 156          void configurar_single_ended (char puerto)
 157          {
 158   1      
 159   1      }
*** WARNING C280 IN LINE 156 OF configurador.c: 'puerto': unreferenced local variable
*** WARNING C294 IN LINE 109 OF configurador.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    240    ----
   CONSTANT SIZE    =     37    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
